@model MinorityDashboardWeb.Models.DistrictAdminModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutDistrictAdmin.cshtml";
}

<div class="tab-pane active" id="fa-icons">
    <div class="card-header">District Scheme Satus Update</div>

    @using (Html.BeginForm("SaveSchemeUpdate", "DistrictAdmin", FormMethod.Post, new { enctype = "multipart/form-data", id = "DocumentForm" }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)

    <div class="card-body">


        <div class="form-group">
            <div class="form-row">
                <div class="col-md-4">
                    <label for="exampleInputName">District</label>
                    @Html.DropDownListFor(s => s.des_id, Model.lstDistrict, new { @class = "form-control" })
                </div>
                <div class="col-md-4">
                    <label for="exampleInputName">Financil Year</label>

                    @Html.DropDownListFor(s => s.fin_y_id, Model.lstFinancialYear, new { @class = "form-control" })

                </div>

                <div class="col-md-4">
                    <label for="exampleInputName">Implementation Agency</label>

                    @Html.DropDownListFor(s => s.imp_agency_id, Model.lstImplementationAgency, new { @class = "form-control" })

                </div>
            </div>
        </div>


        <div class="form-group">
            <div class="form-row">
                <div class="col-md-3">
                    <label for="exampleInputName">Main Scheme</label>
                    @Html.DropDownListFor(s => s.parent_scheme_id, Model.ddlParentScheme, new { @class = "form-control" , disabled = "disabled" })

                </div>
                <div class="col-md-3">

                    <label for="exampleInputName">Scheme Child1</label>
                    @Html.DropDownListFor(s => s.scheme_id_child1, Model.ddlChildScheme1, new { @class = "form-control", disabled = "disabled" })



                </div>
                <div class="col-md-3">
                    <label for="exampleInputName">Scheme Child2</label>
                    @Html.DropDownListFor(s => s.scheme_id_child2, Model.ddlChildScheme2, new { @class = "form-control", disabled = "disabled" })

                </div>
                <div class="col-md-3">

                    <label for="exampleInputName">Scheme Child3</label>
                    @Html.DropDownListFor(s => s.scheme_id_child3, Model.ddlChildScheme3, new { @class = "form-control", disabled = "disabled" })


                </div>
            </div>
        </div>





        <div class="form-group">
            <div class="form-row">
                <div class="col-md-3">
                    <label for="exampleInputName">Budgetary Provision Amount</label>

                    @Html.TextBoxFor(model => model.budgetary_provision_amt, new { @class = "form-control", id = "budgetary_provision_amt", placeholder = "Budgetary Provision Amount", @readonly = true })

                </div>
                <div class="col-md-3">
                    <label for="exampleInputName">Actual Allocation Amount</label>

                    @Html.TextBoxFor(model => model.actual_allocation_amt, new { @class = "form-control", id = "actual_allocation_amt", placeholder = "Actual Allocation Amount", @readonly = true })

                </div>

                <div class="col-md-3">
                    <label for="exampleInputName">Actual Expenditure Amount</label>

                    @Html.TextBoxFor(model => model.actual_expenditure_amt, new { @class = "form-control", id = "actual_expenditure_amt", placeholder = "Actual Expenditure Amount" })

                </div>
                <div class="col-md-3">
                    <label for="exampleInputName">Actual Remaining Amount</label>

                    @Html.TextBoxFor(model => model.actual_remaining_amt, new { @class = "form-control", id = "actual_remaining_amt", placeholder = "Actual Remaining Amount", @readonly = true })

                </div>

            </div>
        </div>


        <div class="form-group">
            <div class="form-row">


                <div class="col-md-6">
                    <label for="exampleInputName">Upload Document</label>
                    @Html.TextBoxFor(a => a.FileDoc, "", new { @class = "form-control", @type = "file" })
                </div>

                <div class="col-md-6">
                    <label for="exampleInputName">Upload UC</label>
                    @Html.TextBoxFor(a => a.Utilizationertificate, "", new { @class = "form-control", @type = "file" })
                </div>

            </div>
        </div>

        <div class="form-group">
            <div class="form-row">

                <div class="col-md-12">
                    <label for="exampleInputName">Work Progress</label>
                    @Html.TextAreaFor(model => model.work_progress_desc, new { @class = "form-control", id = "work_progress_desc", placeholder = "Work Progress" })
                </div>


            </div>
        </div>




        <div class="form-group">
            <div class="form-row">

                <div class="col-md-6">
                    <label for="exampleInputName"></label>

                    @if (Model.id > 0)
                    {
                        <input type="submit" value="Update" class="btn btn-primary btn-block" style="margin-top:7px;background-color: #e4670b;width: 50%;float: right;" />
                    }
                    else
                    {
                        <input type="submit" value="Save" class="btn btn-primary btn-block" style="margin-top:7px; width: 50%;float: right;" />
                    }
                </div>
                <div class="col-md-6">
                    <a href=@Url.Action("DeskData","Admin") style="margin-top:7px;width: 50%;float: left;" class="btn btn-primary btn-block">Cancel</a>
                </div>

            </div>
        </div>


    </div>

    }
</div>

<script type="text/javascript">

    $(document).ready(function () {

        //$("#budgetary_provision_amt").val('100000000');
        //$("#actual_allocation_amt").val('10000000');

    });
</script>


<script type="text/javascript">

    function cleartextbox() {
       $("#budgetary_provision_amt").val('0');
        $("#actual_allocation_amt").val('0');
    }


    $(document).ready(function () {
        $('[data-toggle="popover"]').popover();

        $("#fin_y_id").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/DistrictChange?DistrictId=' + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {

                        document.getElementById("parent_scheme_id").disabled = false;
                        document.getElementById("scheme_id_child1").disabled = false;
                        document.getElementById("scheme_id_child2").disabled = false;
                        document.getElementById("scheme_id_child3").disabled = false;


                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);


                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });

        $("#parent_scheme_id").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ParentChange1?PSchemeid=' + $("#parent_scheme_id").val() +"$" + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        var markup = "<option value='0'>Select</option>";

                        $("#scheme_id_child2").html(markup).show();
                        $("#scheme_id_child3").html(markup).show();

                        for (var x = 0; x < data.length - 2; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#scheme_id_child1").html(markup).show();


                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);


                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });       

        $("#scheme_id_child1").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ChildChange11?ChildSchemeid1=' + $("#parent_scheme_id").val() + "$" + $("#scheme_id_child1").val() + "$" + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        var markup = "<option value='0'>Select</option>";

                        $("#scheme_id_child3").html(markup).show();
                        for (var x = 0; x < data.length - 2; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#scheme_id_child2").html(markup).show();

                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);
                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });

        $("#scheme_id_child2").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ChildChange21?ChildSchemeid2=' + $("#parent_scheme_id").val() + "$" + $("#scheme_id_child1").val() + "$" + $("#scheme_id_child2").val() + "$" + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        var markup = "<option value='0'>Select</option>";
                        for (var x = 0; x < data.length - 2; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#scheme_id_child3").html(markup).show();

                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);
                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });


        $("#scheme_id_child3").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ChildChange31?ChildSchemeid3=' + $("#parent_scheme_id").val() + "$" + $("#scheme_id_child1").val() + "$" + $("#scheme_id_child2").val() + "$" + $("#scheme_id_child3").val() + "$"+ $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                       

                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);
                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });


        $("#actual_expenditure_amt").on('input', function () {

            var tprice = parseFloat($("#actual_allocation_amt").val()) - parseFloat($("#actual_expenditure_amt").val());
         

            $("#actual_remaining_amt").val(tprice);

            // do your stuff
        });

    });
</script>
