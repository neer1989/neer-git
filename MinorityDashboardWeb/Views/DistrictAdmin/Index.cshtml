
<link href="~/Admin_Assets/css/admin_custom.css" rel="stylesheet" />
@model MinorityDashboardWeb.Models.DistrictAdminModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutDistrictAdmin.cshtml";
}

<div class="container-fluid">
    <div class="tab-pane active" id="fa-icons">
        <div class="card-header">District Scheme Satus Update</div>

        @using (Html.BeginForm("SaveSchemeUpdate", "DistrictAdmin", FormMethod.Post, new { enctype = "multipart/form-data", id = "DocumentForm" }))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)

            <div class="card-body">


                <div class="form-group">
                    <div class="form-row">
                        <div class="col-md-4">
                            <label for="exampleInputName">District<span class="req">*</span></label>
                            @Html.DropDownListFor(s => s.des_id, Model.lstDistrict, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.des_id)
                        </div>
                        <div class="col-md-4">
                            <label for="exampleInputName">Financil Year<span class="req">*</span></label>

                            @Html.DropDownListFor(s => s.fin_y_id, Model.lstFinancialYear, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fin_y_id)
                        </div>

                        <div class="col-md-4">
                            <label for="exampleInputName">Implementation Agency<span class="req">*</span></label>

                            @Html.DropDownListFor(s => s.imp_agency_id, Model.lstImplementationAgency, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.imp_agency_id)
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <div class="form-row">
                        <div class="col-md-3">
                            <label for="exampleInputName">Main Scheme<span class="req">*</span></label>
                            @Html.DropDownListFor(s => s.parent_scheme_id, Model.ddlParentScheme, new { @class = "form-control", disabled = "disabled" })
                            @Html.ValidationMessageFor(model => model.parent_scheme_id)
                        </div>
                        <div class="col-md-3">

                            <label for="exampleInputName">Scheme Child1<span class="req">*</span></label>
                            @Html.DropDownListFor(s => s.scheme_id_child1, Model.ddlChildScheme1, new { @class = "form-control", disabled = "disabled" })
                            @Html.ValidationMessageFor(model => model.scheme_id_child1)


                        </div>
                        <div class="col-md-3">
                            <label for="exampleInputName">Scheme Child2<span class="req">*</span></label>
                            @Html.DropDownListFor(s => s.scheme_id_child2, Model.ddlChildScheme2, new { @class = "form-control", disabled = "disabled" })

                        </div>
                        <div class="col-md-3">

                            <label for="exampleInputName">Scheme Child3<span class="req">*</span></label>
                            @Html.DropDownListFor(s => s.scheme_id_child3, Model.ddlChildScheme3, new { @class = "form-control", disabled = "disabled" })


                        </div>
                    </div>
                </div>





                <div class="form-group">
                    <div class="form-row">
                        <div class="col-md-3">
                            <label for="exampleInputName">Budgetary Provision Amount<span class="req">*</span></label>

                            @Html.TextBoxFor(model => model.budgetary_provision_amt, new { @class = "form-control", id = "budgetary_provision_amt", placeholder = "Budgetary Provision Amount", @readonly = true })
                            @Html.ValidationMessageFor(model => model.budgetary_provision_amt)
                        </div>
                        <div class="col-md-3">
                            <label for="exampleInputName">Actual Allocation Amount<span class="req">*</span></label>

                            @Html.TextBoxFor(model => model.actual_allocation_amt, new { @class = "form-control", id = "actual_allocation_amt", placeholder = "Actual Allocation Amount", @readonly = true })
                            @Html.ValidationMessageFor(model => model.actual_allocation_amt)
                        </div>

                        <div class="col-md-3">
                            <label for="exampleInputName">Actual Expenditure Amount<span class="req">*</span></label>

                            @Html.TextBoxFor(model => model.actual_expenditure_amt, new { @class = "form-control", id = "actual_expenditure_amt", placeholder = "Actual Expenditure Amount" })
                            @Html.ValidationMessageFor(model => model.actual_expenditure_amt)
                        </div>
                        <div class="col-md-3">
                            <label for="exampleInputName">Actual Remaining Amount<span class="req">*</span></label>

                            @Html.TextBoxFor(model => model.actual_remaining_amt, new { @class = "form-control", id = "actual_remaining_amt", placeholder = "Actual Remaining Amount", @readonly = true })
                            @Html.ValidationMessageFor(model => model.actual_remaining_amt)
                        </div>

                    </div>
                </div>


                <div class="form-group">
                    <div class="form-row">


                        <div class="col-md-6">
                            <label for="exampleInputName">Upload Document<span class="req">*</span></label>
                            @Html.TextBoxFor(a => a.FileDoc, "", new { @class = "form-control", @type = "file" })
                        </div>

                        <div class="col-md-6">
                            <label for="exampleInputName">Upload UC<span class="req">*</span></label>
                            @Html.TextBoxFor(a => a.Utilizationertificate, "", new { @class = "form-control", @type = "file" })
                        </div>

                    </div>
                </div>

                <div class="form-group">
                    <div class="form-row">

                        <div class="col-md-12">
                            <label for="exampleInputName">Work Progress<span class="req">*</span></label>
                            @Html.TextAreaFor(model => model.work_progress_desc, new { @class = "form-control", id = "work_progress_desc", placeholder = "Work Progress" })
                        </div>


                    </div>
                </div>




                <div class="form-group">
                    <div class="form-row">

                        <div class="col-md-6">
                            <label for="exampleInputName"></label>

                            @if (Model.id > 0)
                            {
                                <input type="submit" value="Update" class="btn btn-primary btn-block" style="margin-top:7px;background-color: #e4670b;width: 50%;float: right;" />
                            }
                            else
                            {
                                <input type="submit" value="Save" class="btn btn-primary btn-block" style="margin-top:7px; width: 50%;float: right;" />
                            }
                        </div>
                        <div class="col-md-6">
                            <a href=@Url.Action("DeskData","Admin") style="margin-top:7px;width: 50%;float: left;" class="btn btn-primary btn-block">Cancel</a>
                        </div>

                    </div>
                </div>


            </div>

        }
    </div>
</div>


<div class="tab-pane" id="glyphicons">
    <div class="card mb-3">
        <div class="card-header">
            <i class="fa fa-table"></i> Desk View
        </div>


        <div class="card-body">
            <div class="table-responsive" id="Grid">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>

                            <th>District Name</th>
                            <th>F-Y</th>
                            <th>Parent Scheme</th>
                            <th>Child Sch1</th>
                            <th>Budgetary Provision</th>
                            <th>Actual Allocation</th>
                            <th>Actual Expenditure Amt</th>
                            <th>Actual Remaining Amt</th>

                            <th>Action</th>

                        </tr>
                    </thead>


                    <tbody>

                        @foreach (var X in Model.lstGetUsedSchemeAmount)
                        {
                          
                        <tr>

                            <td style="border: 1px solid #728590;">@X.des_name</td>
                            <td style="border: 1px solid #728590;">@X.fin_y_id</td>
                            <td style="border: 1px solid #728590;">@X.parent_schemename_e</td>
                            <td style="border: 1px solid #728590;">@X.child1_schemename_e</td>

                            <td style="border: 1px solid #728590;">@X.budgetary_provision_amt</td>
                            <td style="border: 1px solid #728590;">@X.actual_allocation_amt</td>

                            <td style="border: 1px solid #728590;">@X.actual_expenditure_amt</td>
                            <td style="border: 1px solid #728590;">@X.actual_remaining_amt</td>

                            <td>
                                <a href="@Url.Action("EditDeskTrans", "Admin",new { id = X.id })" title="Edit">
                                    <i class="fa fa-edit btn_ico"></i>

                                </a>

                                @*<a href="@Url.Action("DeletDeskTrans", "Admin",new { id = X.id })" onclick="return confirm('Are you sure?');" title="Delete">
                <i class="fa fa-trash btn_ico"></i>

            </a>*@

                                @*@Html.ActionLink("Edit", "EditDeskTrans", new { id = X.id })  |  @Html.ActionLink("Delete", "DeletDeskTrans", new { id = X.id })*@
                            </td>
                        </tr>
                        }

                    </tbody>
                    <tfoot style="background-color: #e7e4e1;">
                        <tr>
                            <td> <b>Total</b> </td>
                            <td> </td>
                            <td> </td>
                            <td> </td>
                            <td> </td>
                            <td> </td>
                            <td> <b></b> </td>
                            <td><b> </b> </td>
                            <td></td>
                        </tr>
                    </tfoot>

                </table>
            </div>
        </div>

    </div>
</div>





<script type="text/javascript">

    $(document).ready(function () {

        //$("#budgetary_provision_amt").val('100000000');
        //$("#actual_allocation_amt").val('10000000');

    });
</script>


<script type="text/javascript">

    function cleartextbox() {
       $("#budgetary_provision_amt").val('0');
        $("#actual_allocation_amt").val('0');
    }


    $(document).ready(function () {
        $('[data-toggle="popover"]').popover();

        $("#fin_y_id").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/DistrictChange?DistrictId=' + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {

                        document.getElementById("parent_scheme_id").disabled = false;
                        document.getElementById("scheme_id_child1").disabled = false;
                        document.getElementById("scheme_id_child2").disabled = false;
                        document.getElementById("scheme_id_child3").disabled = false;


                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);


                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });

        $("#parent_scheme_id").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ParentChange1?PSchemeid=' + $("#parent_scheme_id").val() +"$" + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        var markup = "<option value='0'>Select</option>";

                        $("#scheme_id_child2").html(markup).show();
                        $("#scheme_id_child3").html(markup).show();

                        for (var x = 0; x < data.length - 2; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#scheme_id_child1").html(markup).show();


                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);


                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });       

        $("#scheme_id_child1").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ChildChange11?ChildSchemeid1=' + $("#parent_scheme_id").val() + "$" + $("#scheme_id_child1").val() + "$" + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        var markup = "<option value='0'>Select</option>";

                        $("#scheme_id_child3").html(markup).show();
                        for (var x = 0; x < data.length - 2; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#scheme_id_child2").html(markup).show();

                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);
                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });

        $("#scheme_id_child2").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ChildChange21?ChildSchemeid2=' + $("#parent_scheme_id").val() + "$" + $("#scheme_id_child1").val() + "$" + $("#scheme_id_child2").val() + "$" + $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        var markup = "<option value='0'>Select</option>";
                        for (var x = 0; x < data.length - 2; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#scheme_id_child3").html(markup).show();

                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);
                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });


        $("#scheme_id_child3").on("change", function () {
            $(".modal1212").show();
            cleartextbox();
            $.ajax(
                {
                    url: '/DistrictAdmin/ChildChange31?ChildSchemeid3=' + $("#parent_scheme_id").val() + "$" + $("#scheme_id_child1").val() + "$" + $("#scheme_id_child2").val() + "$" + $("#scheme_id_child3").val() + "$"+ $("#fin_y_id").val(),
                    type: 'POST',
                    data: "",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                       

                        $("#budgetary_provision_amt").val(data[data.length - 1].Value);
                        $("#actual_allocation_amt").val(data[data.length - 2].Value);
                        $(".modal1212").hide();
                    },
                    error: function () {
                        alert("error");
                    }
                });
        });


        $("#actual_expenditure_amt").on('input', function () {

            var tprice = parseFloat($("#actual_allocation_amt").val()) - parseFloat($("#actual_expenditure_amt").val());
         

            $("#actual_remaining_amt").val(tprice);

            // do your stuff
        });

    });
</script>
